<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>../packages_es6/ember-routing/lib/system/router.js - The Ember API</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="The Ember API" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0 pre</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Ember.html">Ember</a></li>
                                <li><a href="../classes/Ember._HandlebarsBoundView.html">Ember._HandlebarsBoundView</a></li>
                                <li><a href="../classes/Ember._Metamorph.html">Ember._Metamorph</a></li>
                                <li><a href="../classes/Ember._MetamorphView.html">Ember._MetamorphView</a></li>
                                <li><a href="../classes/Ember._SimpleMetamorphView.html">Ember._SimpleMetamorphView</a></li>
                                <li><a href="../classes/Ember.ActionHandler.html">Ember.ActionHandler</a></li>
                                <li><a href="../classes/Ember.Application.html">Ember.Application</a></li>
                                <li><a href="../classes/Ember.Array.html">Ember.Array</a></li>
                                <li><a href="../classes/Ember.ArrayController.html">Ember.ArrayController</a></li>
                                <li><a href="../classes/Ember.ArrayProxy.html">Ember.ArrayProxy</a></li>
                                <li><a href="../classes/Ember.AutoLocation.html">Ember.AutoLocation</a></li>
                                <li><a href="../classes/Ember.Binding.html">Ember.Binding</a></li>
                                <li><a href="../classes/Ember.Checkbox.html">Ember.Checkbox</a></li>
                                <li><a href="../classes/Ember.CollectionView.html">Ember.CollectionView</a></li>
                                <li><a href="../classes/Ember.Comparable.html">Ember.Comparable</a></li>
                                <li><a href="../classes/Ember.Component.html">Ember.Component</a></li>
                                <li><a href="../classes/Ember.ComponentTemplateDeprecation.html">Ember.ComponentTemplateDeprecation</a></li>
                                <li><a href="../classes/Ember.ComputedProperty.html">Ember.ComputedProperty</a></li>
                                <li><a href="../classes/Ember.ContainerDebugAdapter.html">Ember.ContainerDebugAdapter</a></li>
                                <li><a href="../classes/Ember.ContainerView.html">Ember.ContainerView</a></li>
                                <li><a href="../classes/Ember.Controller.html">Ember.Controller</a></li>
                                <li><a href="../classes/Ember.ControllerMixin.html">Ember.ControllerMixin</a></li>
                                <li><a href="../classes/Ember.Copyable.html">Ember.Copyable</a></li>
                                <li><a href="../classes/Ember.CoreObject.html">Ember.CoreObject</a></li>
                                <li><a href="../classes/Ember.CoreView.html">Ember.CoreView</a></li>
                                <li><a href="../classes/Ember.DataAdapter.html">Ember.DataAdapter</a></li>
                                <li><a href="../classes/Ember.DefaultResolver.html">Ember.DefaultResolver</a></li>
                                <li><a href="../classes/Ember.Deferred.html">Ember.Deferred</a></li>
                                <li><a href="../classes/Ember.Descriptor.html">Ember.Descriptor</a></li>
                                <li><a href="../classes/Ember.EachProxy.html">Ember.EachProxy</a></li>
                                <li><a href="../classes/Ember.Enumerable.html">Ember.Enumerable</a></li>
                                <li><a href="../classes/Ember.EnumerableUtils.html">Ember.EnumerableUtils</a></li>
                                <li><a href="../classes/Ember.Error.html">Ember.Error</a></li>
                                <li><a href="../classes/Ember.EventDispatcher.html">Ember.EventDispatcher</a></li>
                                <li><a href="../classes/Ember.Evented.html">Ember.Evented</a></li>
                                <li><a href="../classes/Ember.FEATURES.html">Ember.FEATURES</a></li>
                                <li><a href="../classes/Ember.Freezable.html">Ember.Freezable</a></li>
                                <li><a href="../classes/Ember.Handlebars.html">Ember.Handlebars</a></li>
                                <li><a href="../classes/Ember.Handlebars.Compiler.html">Ember.Handlebars.Compiler</a></li>
                                <li><a href="../classes/Ember.Handlebars.helpers.html">Ember.Handlebars.helpers</a></li>
                                <li><a href="../classes/Ember.Handlebars.JavaScriptCompiler.html">Ember.Handlebars.JavaScriptCompiler</a></li>
                                <li><a href="../classes/Ember.HashLocation.html">Ember.HashLocation</a></li>
                                <li><a href="../classes/Ember.HistoryLocation.html">Ember.HistoryLocation</a></li>
                                <li><a href="../classes/Ember.Instrumentation.html">Ember.Instrumentation</a></li>
                                <li><a href="../classes/Ember.LinkView.html">Ember.LinkView</a></li>
                                <li><a href="../classes/Ember.Location.html">Ember.Location</a></li>
                                <li><a href="../classes/Ember.Logger.html">Ember.Logger</a></li>
                                <li><a href="../classes/Ember.Map.html">Ember.Map</a></li>
                                <li><a href="../classes/Ember.MapWithDefault.html">Ember.MapWithDefault</a></li>
                                <li><a href="../classes/Ember.Mixin.html">Ember.Mixin</a></li>
                                <li><a href="../classes/Ember.MutableArray.html">Ember.MutableArray</a></li>
                                <li><a href="../classes/Ember.MutableEnumerable.html">Ember.MutableEnumerable</a></li>
                                <li><a href="../classes/Ember.Namespace.html">Ember.Namespace</a></li>
                                <li><a href="../classes/Ember.NativeArray.html">Ember.NativeArray</a></li>
                                <li><a href="../classes/Ember.NoneLocation.html">Ember.NoneLocation</a></li>
                                <li><a href="../classes/Ember.Object.html">Ember.Object</a></li>
                                <li><a href="../classes/Ember.ObjectController.html">Ember.ObjectController</a></li>
                                <li><a href="../classes/Ember.ObjectProxy.html">Ember.ObjectProxy</a></li>
                                <li><a href="../classes/Ember.Observable.html">Ember.Observable</a></li>
                                <li><a href="../classes/Ember.OrderedSet.html">Ember.OrderedSet</a></li>
                                <li><a href="../classes/Ember.platform.html">Ember.platform</a></li>
                                <li><a href="../classes/Ember.PromiseProxyMixin.html">Ember.PromiseProxyMixin</a></li>
                                <li><a href="../classes/Ember.ReduceComputedProperty.html">Ember.ReduceComputedProperty</a></li>
                                <li><a href="../classes/Ember.RenderBuffer.html">Ember.RenderBuffer</a></li>
                                <li><a href="../classes/Ember.Route.html">Ember.Route</a></li>
                                <li><a href="../classes/Ember.Router.html">Ember.Router</a></li>
                                <li><a href="../classes/Ember.RSVP.html">Ember.RSVP</a></li>
                                <li><a href="../classes/Ember.RSVP.EventTarget.html">Ember.RSVP.EventTarget</a></li>
                                <li><a href="../classes/Ember.RSVP.Promise.html">Ember.RSVP.Promise</a></li>
                                <li><a href="../classes/Ember.Select.html">Ember.Select</a></li>
                                <li><a href="../classes/Ember.Set.html">Ember.Set</a></li>
                                <li><a href="../classes/Ember.SortableMixin.html">Ember.SortableMixin</a></li>
                                <li><a href="../classes/Ember.State.html">Ember.State</a></li>
                                <li><a href="../classes/Ember.StateManager.html">Ember.StateManager</a></li>
                                <li><a href="../classes/Ember.String.html">Ember.String</a></li>
                                <li><a href="../classes/Ember.SubArray.html">Ember.SubArray</a></li>
                                <li><a href="../classes/Ember.TargetActionSupport.html">Ember.TargetActionSupport</a></li>
                                <li><a href="../classes/Ember.Test.html">Ember.Test</a></li>
                                <li><a href="../classes/Ember.Test.Adapter.html">Ember.Test.Adapter</a></li>
                                <li><a href="../classes/Ember.Test.QUnitAdapter.html">Ember.Test.QUnitAdapter</a></li>
                                <li><a href="../classes/Ember.TextArea.html">Ember.TextArea</a></li>
                                <li><a href="../classes/Ember.TextField.html">Ember.TextField</a></li>
                                <li><a href="../classes/Ember.TextSupport.html">Ember.TextSupport</a></li>
                                <li><a href="../classes/Ember.TrackedArray.html">Ember.TrackedArray</a></li>
                                <li><a href="../classes/Ember.View.html">Ember.View</a></li>
                                <li><a href="../classes/Ember.ViewTargetActionSupport.html">Ember.ViewTargetActionSupport</a></li>
                                <li><a href="../classes/Function.html">Function</a></li>
                                <li><a href="../classes/run.run.html">run.run</a></li>
                                <li><a href="../classes/String.html">String</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/ember.html">ember</a></li>
                                <li><a href="../modules/ember-application.html">ember-application</a></li>
                                <li><a href="../modules/ember-debug.html">ember-debug</a></li>
                                <li><a href="../modules/ember-extension-support.html">ember-extension-support</a></li>
                                <li><a href="../modules/ember-handlebars.html">ember-handlebars</a></li>
                                <li><a href="../modules/ember-handlebars-compiler.html">ember-handlebars-compiler</a></li>
                                <li><a href="../modules/ember-metal.html">ember-metal</a></li>
                                <li><a href="../modules/ember-routing.html">ember-routing</a></li>
                                <li><a href="../modules/ember-runtime.html">ember-runtime</a></li>
                                <li><a href="../modules/ember-testing.html">ember-testing</a></li>
                                <li><a href="../modules/ember-views.html">ember-views</a></li>
                                <li><a href="../modules/RSVP.html">RSVP</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: ../packages_es6/ember-routing/lib/system/router.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
import Ember from &quot;ember-metal/core&quot;; // FEATURES, Logger, K, assert
import EmberError from &quot;ember-metal/error&quot;;
import {get} from &quot;ember-metal/property_get&quot;;
import {set} from &quot;ember-metal/property_set&quot;;
import {forEach} from &quot;ember-metal/array&quot;;
import {defineProperty} from &quot;ember-metal/properties&quot;;
import {computed} from &quot;ember-metal/computed&quot;;
import merge from &quot;ember-metal/merge&quot;;
import run from &quot;ember-metal/run_loop&quot;;
import EnumerableUtils from &quot;ember-metal/enumerable_utils&quot;;

import {fmt} from &quot;ember-runtime/system/string&quot;;
import EmberObject from &quot;ember-runtime/system/object&quot;;
import Evented from &quot;ember-runtime/mixins/evented&quot;;
import EmberRouterDSL from &quot;ember-routing/system/dsl&quot;;
import {View as EmberView} from &quot;ember-views/views/view&quot;;
import EmberLocation from &quot;ember-routing/location/api&quot;;
import {_MetamorphView} from &quot;ember-handlebars/views/metamorph_view&quot;;

// requireModule(&quot;ember-handlebars&quot;);
// requireModule(&quot;ember-runtime&quot;);
// requireModule(&quot;ember-views&quot;);

/**
@module ember
@submodule ember-routing
*/

// // side effect of loading some Ember globals, for now
// requireModule(&quot;ember-handlebars&quot;);
// requireModule(&quot;ember-runtime&quot;);
// requireModule(&quot;ember-views&quot;);

var Router = requireModule(&quot;router&quot;)[&#x27;default&#x27;];
var Transition = requireModule(&quot;router/transition&quot;).Transition;

var slice = [].slice;
var forEach = EnumerableUtils.forEach;

var DefaultView = _MetamorphView;

/**
  The &#x60;Ember.Router&#x60; class manages the application state and URLs. Refer to
  the [routing guide](http://emberjs.com/guides/routing/) for documentation.

  @class Router
  @namespace Ember
  @extends Ember.Object
*/
var EmberRouter = EmberObject.extend(Evented, {
  /**
    The &#x60;location&#x60; property determines the type of URL&#x27;s that your
    application will use.

    The following location types are currently available:

    * &#x60;hash&#x60;
    * &#x60;history&#x60;
    * &#x60;none&#x60;

    @property location
    @default &#x27;hash&#x27;
    @see {Ember.Location}
  */
  location: &#x27;hash&#x27;,

  /**
   Represents the URL of the root of the application, often &#x27;/&#x27;. This prefix is
   assumed on all routes defined on this router.

   @property rootURL
   @default &#x27;/&#x27;
  */
  rootURL: &#x27;/&#x27;,

  init: function() {
    this.router = this.constructor.router || this.constructor.map(Ember.K);
    this._activeViews = {};
    this._setupLocation();
    this._qpCache = {};
    this._queuedQPChanges = {};

    if (get(this, &#x27;namespace.LOG_TRANSITIONS_INTERNAL&#x27;)) {
      this.router.log = Ember.Logger.debug;
    }
  },

  /**
    Represents the current URL.

    @method url
    @return {String} The current URL.
  */
  url: computed(function() {
    return get(this, &#x27;location&#x27;).getURL();
  }),

  /**
    Initializes the current router instance and sets up the change handling
    event listeners used by the instances &#x60;location&#x60; implementation.

    A property named &#x60;initialURL&#x60; will be used to determine the initial URL.
    If no value is found &#x60;/&#x60; will be used.

    @method startRouting
    @private
  */
  startRouting: function() {
    this.router = this.router || this.constructor.map(Ember.K);

    var router = this.router,
        location = get(this, &#x27;location&#x27;),
        container = this.container,
        self = this,
        initialURL = get(this, &#x27;initialURL&#x27;);

    // Allow the Location class to cancel the router setup while it refreshes
    // the page
    if (get(location, &#x27;cancelRouterSetup&#x27;)) {
      return;
    }

    this._setupRouter(router, location);

    container.register(&#x27;view:default&#x27;, DefaultView);
    container.register(&#x27;view:toplevel&#x27;, EmberView.extend());

    location.onUpdateURL(function(url) {
      self.handleURL(url);
    });

    if (typeof initialURL === &quot;undefined&quot;) {
      initialURL = location.getURL();
    }

    this.handleURL(initialURL);
  },

  /**
    Handles updating the paths and notifying any listeners of the URL
    change.

    Triggers the router level &#x60;didTransition&#x60; hook.

    @method didTransition
    @private
    @since 1.2.0
  */
  didTransition: function(infos) {
    updatePaths(this);

    this._cancelLoadingEvent();

    this.notifyPropertyChange(&#x27;url&#x27;);

    // Put this in the runloop so url will be accurate. Seems
    // less surprising than didTransition being out of sync.
    run.once(this, this.trigger, &#x27;didTransition&#x27;);

    if (get(this, &#x27;namespace&#x27;).LOG_TRANSITIONS) {
      Ember.Logger.log(&quot;Transitioned into &#x27;&quot; + EmberRouter._routePath(infos) + &quot;&#x27;&quot;);
    }
  },

  handleURL: function(url) {
    return this._doTransition(&#x27;handleURL&#x27;, [url]);
  },

  transitionTo: function() {
    return this._doTransition(&#x27;transitionTo&#x27;, arguments);
  },

  intermediateTransitionTo: function() {
    this.router.intermediateTransitionTo.apply(this.router, arguments);

    updatePaths(this);

    var infos = this.router.currentHandlerInfos;
    if (get(this, &#x27;namespace&#x27;).LOG_TRANSITIONS) {
      Ember.Logger.log(&quot;Intermediate-transitioned into &#x27;&quot; + EmberRouter._routePath(infos) + &quot;&#x27;&quot;);
    }
  },

  replaceWith: function() {
    return this._doTransition(&#x27;replaceWith&#x27;, arguments);
  },

  generate: function() {
    var url = this.router.generate.apply(this.router, arguments);
    return this.location.formatURL(url);
  },

  /**
    Determines if the supplied route is currently active.

    @method isActive
    @param routeName
    @return {Boolean}
    @private
  */
  isActive: function(routeName) {
    var router = this.router;
    return router.isActive.apply(router, arguments);
  },

  send: function(name, context) {
    this.router.trigger.apply(this.router, arguments);
  },

  /**
    Does this router instance have the given route.

    @method hasRoute
    @return {Boolean}
    @private
  */
  hasRoute: function(route) {
    return this.router.hasRoute(route);
  },

  /**
    Resets the state of the router by clearing the current route
    handlers and deactivating them.

    @private
    @method reset
   */
  reset: function() {
    this.router.reset();
  },

  _lookupActiveView: function(templateName) {
    var active = this._activeViews[templateName];
    return active &amp;&amp; active[0];
  },

  _connectActiveView: function(templateName, view) {
    var existing = this._activeViews[templateName];

    if (existing) {
      existing[0].off(&#x27;willDestroyElement&#x27;, this, existing[1]);
    }

    function disconnectActiveView() {
      delete this._activeViews[templateName];
    }

    this._activeViews[templateName] = [view, disconnectActiveView];
    view.one(&#x27;willDestroyElement&#x27;, this, disconnectActiveView);
  },

  _setupLocation: function() {
    var location = get(this, &#x27;location&#x27;),
        rootURL = get(this, &#x27;rootURL&#x27;);

    if (rootURL &amp;&amp; !this.container.has(&#x27;-location-setting:root-url&#x27;)) {
      this.container.register(&#x27;-location-setting:root-url&#x27;, rootURL, { instantiate: false });
    }

    if (&#x27;string&#x27; === typeof location &amp;&amp; this.container) {
      var resolvedLocation = this.container.lookup(&#x27;location:&#x27; + location);

      if (&#x27;undefined&#x27; !== typeof resolvedLocation) {
        location = set(this, &#x27;location&#x27;, resolvedLocation);
      } else {
        // Allow for deprecated registration of custom location API&#x27;s
        var options = {implementation: location};

        location = set(this, &#x27;location&#x27;, EmberLocation.create(options));
      }
    }

    if (rootURL &amp;&amp; typeof rootURL === &#x27;string&#x27;) {
      location.rootURL = rootURL;
    }

    // ensure that initState is called AFTER the rootURL is set on
    // the location instance
    if (typeof location.initState === &#x27;function&#x27;) { location.initState(); }
  },

  _getHandlerFunction: function() {
    var seen = {}, container = this.container,
        DefaultRoute = container.lookupFactory(&#x27;route:basic&#x27;),
        self = this;

    return function(name) {
      var routeName = &#x27;route:&#x27; + name,
          handler = container.lookup(routeName);

      if (seen[name]) { return handler; }

      seen[name] = true;

      if (!handler) {
        container.register(routeName, DefaultRoute.extend());
        handler = container.lookup(routeName);

        if (get(self, &#x27;namespace.LOG_ACTIVE_GENERATION&#x27;)) {
          Ember.Logger.info(&quot;generated -&gt; &quot; + routeName, { fullName: routeName });
        }
      }

      handler.routeName = name;
      return handler;
    };
  },

  _setupRouter: function(router, location) {
    var lastURL, emberRouter = this;

    router.getHandler = this._getHandlerFunction();

    var doUpdateURL = function() {
      location.setURL(lastURL);
    };

    router.updateURL = function(path) {
      lastURL = path;
      run.once(doUpdateURL);
    };

    if (location.replaceURL) {
      var doReplaceURL = function() {
        location.replaceURL(lastURL);
      };

      router.replaceURL = function(path) {
        lastURL = path;
        run.once(doReplaceURL);
      };
    }

    router.didTransition = function(infos) {
      emberRouter.didTransition(infos);
    };
  },

  _doTransition: function(method, args) {
    // Normalize blank route to root URL.
    args = slice.call(args);
    args[0] = args[0] || &#x27;/&#x27;;

    var name = args[0], self = this,
      isQueryParamsOnly = false, queryParams;

    if (Ember.FEATURES.isEnabled(&quot;query-params-new&quot;)) {

      var possibleQueryParamArg = args[args.length - 1];
      if (possibleQueryParamArg &amp;&amp; possibleQueryParamArg.hasOwnProperty(&#x27;queryParams&#x27;)) {
        if (args.length === 1) {
          isQueryParamsOnly = true;
          name = null;
        }
        queryParams = args[args.length - 1].queryParams;
      }
    }

    if (!isQueryParamsOnly &amp;&amp; name.charAt(0) !== &#x27;/&#x27;) {
      Ember.assert(&quot;The route &quot; + name + &quot; was not found&quot;, this.router.hasRoute(name));
    }

    if (queryParams) {
      // router.js expects queryParams to be passed in in
      // their final serialized form, so we need to translate.

      if (!name) {
        // Need to determine destination route name.
        var handlerInfos = this.router.activeTransition ?
                           this.router.activeTransition.state.handlerInfos :
                           this.router.state.handlerInfos;
        name = handlerInfos[handlerInfos.length - 1].name;
        args.unshift(name);
      }

      var qpCache = this._queryParamsFor(name), qps = qpCache.qps;

      var finalParams = {};
      for (var key in queryParams) {
        if (!queryParams.hasOwnProperty(key)) { continue; }
        var inputValue = queryParams[key],
            qp = qpCache.map[key];

        if (!qp) {
          throw new EmberError(&quot;Unrecognized query param &quot; + key + &quot; provided as transition argument&quot;);
        }
        finalParams[qp.urlKey] = qp.route.serializeQueryParam(inputValue, qp.urlKey, qp.type);
      }

      // Perform any necessary serialization.
      args[args.length-1].queryParams = finalParams;
    }

    var transitionPromise = this.router[method].apply(this.router, args);

    transitionPromise.then(null, function(error) {
      if (error &amp;&amp; error.name === &quot;UnrecognizedURLError&quot;) {
        Ember.assert(&quot;The URL &#x27;&quot; + error.message + &quot;&#x27; did not match any routes in your application&quot;);
      }
    }, &#x27;Ember: Check for Router unrecognized URL error&#x27;);

    // We want to return the configurable promise object
    // so that callers of this function can use &#x60;.method()&#x60; on it,
    // which obviously doesn&#x27;t exist for normal RSVP promises.
    return transitionPromise;
  },

  _queryParamsFor: function(leafRouteName) {
    if (this._qpCache[leafRouteName]) {
      return this._qpCache[leafRouteName];
    }

    var map = {}, qps = [], qpCache = this._qpCache[leafRouteName] = {
      map: map,
      qps: qps
    };

    var routerjs = this.router,
        recogHandlerInfos = routerjs.recognizer.handlersFor(leafRouteName);

    for (var i = 0, len = recogHandlerInfos.length; i &lt; len; ++i) {
      var recogHandler = recogHandlerInfos[i],
          route = routerjs.getHandler(recogHandler.handler),
          qpMeta = get(route, &#x27;_qp&#x27;);

      if (!qpMeta) { continue; }

      merge(map, qpMeta.map);
      qps.push.apply(qps, qpMeta.qps);
    }

    return {
      qps: qps,
      map: map
    };
  },

  _scheduleLoadingEvent: function(transition, originRoute) {
    this._cancelLoadingEvent();
    this._loadingStateTimer = run.scheduleOnce(&#x27;routerTransitions&#x27;, this, &#x27;_fireLoadingEvent&#x27;, transition, originRoute);
  },

  _fireLoadingEvent: function(transition, originRoute) {
    if (!this.router.activeTransition) {
      // Don&#x27;t fire an event if we&#x27;ve since moved on from
      // the transition that put us in a loading state.
      return;
    }

    transition.trigger(true, &#x27;loading&#x27;, transition, originRoute);
  },

  _cancelLoadingEvent: function () {
    if (this._loadingStateTimer) {
      run.cancel(this._loadingStateTimer);
    }
    this._loadingStateTimer = null;
  }
});

function controllerOrProtoFor(controllerName, container, getProto) {
  var fullName = container.normalize(&#x27;controller:&#x27; + controllerName);
  if (!getProto &amp;&amp; container.cache.has(fullName)) {
    return container.lookup(fullName);
  } else {
    // Controller hasn&#x27;t been instantiated yet; just return its proto.
    var controllerClass = container.lookupFactory(fullName);
    if (controllerClass &amp;&amp; typeof controllerClass.proto === &#x27;function&#x27;) {
      return controllerClass.proto();
    } else {
      return {};
    }
  }
}

/*
  Helper function for iterating root-ward, starting
  from (but not including) the provided &#x60;originRoute&#x60;.

  Returns true if the last callback fired requested
  to bubble upward.

  @private
 */
function forEachRouteAbove(originRoute, transition, callback) {
  var handlerInfos = transition.state.handlerInfos,
      originRouteFound = false;

  for (var i = handlerInfos.length - 1; i &gt;= 0; --i) {
    var handlerInfo = handlerInfos[i],
        route = handlerInfo.handler;

    if (!originRouteFound) {
      if (originRoute === route) {
        originRouteFound = true;
      }
      continue;
    }

    if (callback(route, handlerInfos[i + 1].handler) !== true) {
      return false;
    }
  }
  return true;
}

// These get invoked when an action bubbles above ApplicationRoute
// and are not meant to be overridable.
var defaultActionHandlers = {

  willResolveModel: function(transition, originRoute) {
    originRoute.router._scheduleLoadingEvent(transition, originRoute);
  },

  error: function(error, transition, originRoute) {
    // Attempt to find an appropriate error substate to enter.
    var router = originRoute.router;

    var tryTopLevel = forEachRouteAbove(originRoute, transition, function(route, childRoute) {
      var childErrorRouteName = findChildRouteName(route, childRoute, &#x27;error&#x27;);
      if (childErrorRouteName) {
        router.intermediateTransitionTo(childErrorRouteName, error);
        return;
      }
      return true;
    });

    if (tryTopLevel) {
      // Check for top-level error state to enter.
      if (routeHasBeenDefined(originRoute.router, &#x27;application_error&#x27;)) {
        router.intermediateTransitionTo(&#x27;application_error&#x27;, error);
        return;
      }
    } else {
      // Don&#x27;t fire an assertion if we found an error substate.
      return;
    }

    var errorArgs = [&#x27;Error while loading route: &#x27; + transition.targetName];

    if (error) {
      if (error.message) { errorArgs.push(error.message); }
      if (error.stack)   { errorArgs.push(error.stack); }

      if (typeof error === &quot;string&quot;) { errorArgs.push(error); }
    }

    Ember.Logger.error.apply(this, errorArgs);
  },

  loading: function(transition, originRoute) {
    // Attempt to find an appropriate loading substate to enter.
    var router = originRoute.router;

    var tryTopLevel = forEachRouteAbove(originRoute, transition, function(route, childRoute) {
      var childLoadingRouteName = findChildRouteName(route, childRoute, &#x27;loading&#x27;);

      if (childLoadingRouteName) {
        router.intermediateTransitionTo(childLoadingRouteName);
        return;
      }

      // Don&#x27;t bubble above pivot route.
      if (transition.pivotHandler !== route) {
        return true;
      }
    });

    if (tryTopLevel) {
      // Check for top-level loading state to enter.
      if (routeHasBeenDefined(originRoute.router, &#x27;application_loading&#x27;)) {
        router.intermediateTransitionTo(&#x27;application_loading&#x27;);
        return;
      }
    }
  }
};

function findChildRouteName(parentRoute, originatingChildRoute, name) {
  var router = parentRoute.router,
      childName,
      targetChildRouteName = originatingChildRoute.routeName.split(&#x27;.&#x27;).pop(),
      namespace = parentRoute.routeName === &#x27;application&#x27; ? &#x27;&#x27; : parentRoute.routeName + &#x27;.&#x27;;

  if (Ember.FEATURES.isEnabled(&quot;ember-routing-named-substates&quot;)) {
    // First, try a named loading state, e.g. &#x27;foo_loading&#x27;
    childName = namespace + targetChildRouteName + &#x27;_&#x27; + name;
    if (routeHasBeenDefined(router, childName)) {
      return childName;
    }
  }

  // Second, try general loading state, e.g. &#x27;loading&#x27;
  childName = namespace + name;
  if (routeHasBeenDefined(router, childName)) {
    return childName;
  }
}

function routeHasBeenDefined(router, name) {
  var container = router.container;
  return router.hasRoute(name) &amp;&amp;
         (container.has(&#x27;template:&#x27; + name) || container.has(&#x27;route:&#x27; + name));
}

function triggerEvent(handlerInfos, ignoreFailure, args) {
  var name = args.shift();

  if (!handlerInfos) {
    if (ignoreFailure) { return; }
    throw new EmberError(&quot;Can&#x27;t trigger action &#x27;&quot; + name + &quot;&#x27; because your app hasn&#x27;t finished transitioning into its first route. To trigger an action on destination routes during a transition, you can call &#x60;.send()&#x60; on the &#x60;Transition&#x60; object passed to the &#x60;model/beforeModel/afterModel&#x60; hooks.&quot;);
  }

  var eventWasHandled = false;

  for (var i = handlerInfos.length - 1; i &gt;= 0; i--) {
    var handlerInfo = handlerInfos[i],
        handler = handlerInfo.handler;

    if (handler._actions &amp;&amp; handler._actions[name]) {
      if (handler._actions[name].apply(handler, args) === true) {
        eventWasHandled = true;
      } else {
        return;
      }
    }
  }

  if (defaultActionHandlers[name]) {
    defaultActionHandlers[name].apply(null, args);
    return;
  }

  if (!eventWasHandled &amp;&amp; !ignoreFailure) {
    throw new EmberError(&quot;Nothing handled the action &#x27;&quot; + name + &quot;&#x27;. If you did handle the action, this error can be caused by returning true from an action handler in a controller, causing the action to bubble.&quot;);
  }
}

function updatePaths(router) {
  var appController = router.container.lookup(&#x27;controller:application&#x27;);

  if (!appController) {
    // appController might not exist when top-level loading/error
    // substates have been entered since ApplicationRoute hasn&#x27;t
    // actually been entered at that point.
    return;
  }

  var infos = router.router.currentHandlerInfos,
      path = EmberRouter._routePath(infos);

  if (!(&#x27;currentPath&#x27; in appController)) {
    defineProperty(appController, &#x27;currentPath&#x27;);
  }

  set(appController, &#x27;currentPath&#x27;, path);

  if (!(&#x27;currentRouteName&#x27; in appController)) {
    defineProperty(appController, &#x27;currentRouteName&#x27;);
  }

  set(appController, &#x27;currentRouteName&#x27;, infos[infos.length - 1].name);
}

EmberRouter.reopenClass({
  router: null,
  map: function(callback) {
    var router = this.router;
    if (!router) {
      router = new Router();
      router.callbacks = [];
      router.triggerEvent = triggerEvent;
      this.reopenClass({ router: router });
    }

    var dsl = EmberRouterDSL.map(function() {
      this.resource(&#x27;application&#x27;, { path: &quot;/&quot; }, function() {
        for (var i=0; i &lt; router.callbacks.length; i++) {
          router.callbacks[i].call(this);
        }
        callback.call(this);
      });
    });

    router.callbacks.push(callback);
    router.map(dsl.generate());
    return router;
  },

  _routePath: function(handlerInfos) {
    var path = [];

    // We have to handle coalescing resource names that
    // are prefixed with their parent&#x27;s names, e.g.
    // [&#x27;foo&#x27;, &#x27;foo.bar.baz&#x27;] =&gt; &#x27;foo.bar.baz&#x27;, not &#x27;foo.foo.bar.baz&#x27;

    function intersectionMatches(a1, a2) {
      for (var i = 0, len = a1.length; i &lt; len; ++i) {
        if (a1[i] !== a2[i]) {
          return false;
        }
      }
      return true;
    }

    for (var i=1, l=handlerInfos.length; i&lt;l; i++) {
      var name = handlerInfos[i].name,
          nameParts = name.split(&quot;.&quot;),
          oldNameParts = slice.call(path);

      while (oldNameParts.length) {
        if (intersectionMatches(oldNameParts, nameParts)) {
          break;
        }
        oldNameParts.shift();
      }

      path.push.apply(path, nameParts.slice(oldNameParts.length));
    }

    return path.join(&quot;.&quot;);
  }
});

export default EmberRouter;

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
